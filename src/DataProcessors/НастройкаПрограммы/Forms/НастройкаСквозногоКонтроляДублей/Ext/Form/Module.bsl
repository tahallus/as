
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ЗаполнитьНастройкиКонтроляДублейЛиды();
	ЗаполнитьНастройкиКонтроляДублейКонтакты();
	ЗаполнитьНастройкиКонтроляДублейКонтрагенты();
	
	НастройкиПоЛидам     = Константы.НастройкиКонтроляДублейЛиды.Получить().Получить();	
	НастройкиПоКонтактам = Константы.НастройкиКонтроляДублейКонтакты.Получить().Получить();
	НастройкиПоКонтрагентам = Константы.НастройкиКонтроляДублейКонтрагенты.Получить().Получить();
	
	// Контроль по наименованию
	НовоеСоответствие = НастройкиКонтроля.Добавить();
	НовоеСоответствие.РеквизитЛида = "Имя фамилия, Представление в программе";
	НовоеСоответствие.ПроверятьРеквизитЛида = НастройкиПоЛидам.Получить("ПроверятьНаименование");
	НовоеСоответствие.РеквизитКонтакта = "Имя фамилия";
	НовоеСоответствие.ПроверятьРеквизитКонтакта = НастройкиПоКонтактам.Получить("ПроверятьНаименование");
	НовоеСоответствие.РеквизитКонтрагента = "Представление в программе";
	НовоеСоответствие.ПроверятьРеквизитКонтрагента = НастройкиПоКонтрагентам.Получить("ПроверятьНаименование");
	
	// Контроль по номеру телефона
	НовоеСоответствие = НастройкиКонтроля.Добавить();
	НовоеСоответствие.РеквизитЛида = "Телефон";
	НовоеСоответствие.ПроверятьРеквизитЛида = НастройкиПоЛидам.Получить("ПроверятьТелефон");
	НовоеСоответствие.РеквизитКонтакта = "Телефон";
	НовоеСоответствие.ПроверятьРеквизитКонтакта = НастройкиПоКонтактам.Получить("ПроверятьТелефон");
	НовоеСоответствие.РеквизитКонтрагента = "Телефон";
	НовоеСоответствие.ПроверятьРеквизитКонтрагента = НастройкиПоКонтрагентам.Получить("ПроверятьТелефон");
	
	// Контроль по адресу ЭП
	НовоеСоответствие = НастройкиКонтроля.Добавить();
	НовоеСоответствие.РеквизитЛида = "E-mail";
	НовоеСоответствие.ПроверятьРеквизитЛида = НастройкиПоЛидам.Получить("ПроверятьАдресЭП");
	НовоеСоответствие.РеквизитКонтакта = "E-mail";
	НовоеСоответствие.ПроверятьРеквизитКонтакта = НастройкиПоКонтактам.Получить("ПроверятьАдресЭП");
	НовоеСоответствие.РеквизитКонтрагента = "E-mail";
	НовоеСоответствие.ПроверятьРеквизитКонтрагента = НастройкиПоКонтрагентам.Получить("ПроверятьАдресЭП");
	
	// Контроль по юр.названию (только лиды и контрагенты)
	НовоеСоответствие = НастройкиКонтроля.Добавить();
	НовоеСоответствие.РеквизитЛида = "Юридическое название";
	НовоеСоответствие.ПроверятьРеквизитЛида = НастройкиПоЛидам.Получить("ПроверятьЮрНазвание");
	НовоеСоответствие.РеквизитКонтрагента = "Юридическое название";
	НовоеСоответствие.ПроверятьРеквизитКонтрагента =  НастройкиПоКонтрагентам.Получить("ПроверятьЮрНазвание");
	
	// Контроль по ИНН(не настраиваемая)
	НовоеСоответствие = НастройкиКонтроля.Добавить();
	НовоеСоответствие.РеквизитКонтрагента = "ИНН";
	НовоеСоответствие.ПроверятьРеквизитКонтрагента = Истина;
	
	// Контроль по КПП(не настраиваемая)
	НовоеСоответствие = НастройкиКонтроля.Добавить();
	НовоеСоответствие.РеквизитКонтрагента = "КПП";
	НовоеСоответствие.ПроверятьРеквизитКонтрагента = Истина;

КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, ЗавершениеРаботы, ТекстПредупреждения, СтандартнаяОбработка)
	УстановитьНастройкиКонтроля();
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура УстановитьНастройкиКонтроля()
	УстановитьНастройкиКонтроляЛиды();
	УстановитьНастройкиКонтроляКонтакты();
	УстановитьНастройкиКонтроляКонтрагенты();
КонецПроцедуры

&НаСервере
Процедура УстановитьНастройкиКонтроляЛиды()
	
	Результат = Новый Соответствие;
	Результат.Вставить("ПроверятьНаименование", НастройкиКонтроля[0].ПроверятьРеквизитЛида);
	Результат.Вставить("ПроверятьТелефон",      НастройкиКонтроля[1].ПроверятьРеквизитЛида);
	Результат.Вставить("ПроверятьАдресЭП",      НастройкиКонтроля[2].ПроверятьРеквизитЛида);
	Результат.Вставить("ПроверятьЮрНазвание",   НастройкиКонтроля[3].ПроверятьРеквизитЛида);
	
	Константы.НастройкиКонтроляДублейЛиды.Установить(Новый ХранилищеЗначения(Результат, Новый СжатиеДанных(6)));
	
КонецПроцедуры

&НаСервере
Процедура УстановитьНастройкиКонтроляКонтакты()
	
	Результат = Новый Соответствие;
	Результат.Вставить("ПроверятьНаименование", НастройкиКонтроля[0].ПроверятьРеквизитКонтакта);
	Результат.Вставить("ПроверятьТелефон",      НастройкиКонтроля[1].ПроверятьРеквизитКонтакта);
	Результат.Вставить("ПроверятьАдресЭП",      НастройкиКонтроля[2].ПроверятьРеквизитКонтакта);
	
	Константы.НастройкиКонтроляДублейКонтакты.Установить(Новый ХранилищеЗначения(Результат, Новый СжатиеДанных(6)));
	
КонецПроцедуры

&НаСервере
Процедура УстановитьНастройкиКонтроляКонтрагенты()
	
	Результат = Новый Соответствие;
	Результат.Вставить("ПроверятьНаименование", НастройкиКонтроля[0].ПроверятьРеквизитКонтрагента);
	Результат.Вставить("ПроверятьТелефон",      НастройкиКонтроля[1].ПроверятьРеквизитКонтрагента);
	Результат.Вставить("ПроверятьАдресЭП",      НастройкиКонтроля[2].ПроверятьРеквизитКонтрагента);
	Результат.Вставить("ПроверятьЮрНазвание",   НастройкиКонтроля[3].ПроверятьРеквизитКонтрагента);
	
	Константы.НастройкиКонтроляДублейКонтрагенты.Установить(Новый ХранилищеЗначения(Результат, Новый СжатиеДанных(6)));
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьНастройкиКонтроляДублейЛиды() 
	
	НастройкиЛиды = Константы.НастройкиКонтроляДублейЛиды.Получить().Получить();
	
	Если НастройкиЛиды = Неопределено Тогда
		Результат = Новый Соответствие;
		Результат.Вставить("ПроверятьНаименование", Ложь);
		Результат.Вставить("ПроверятьТелефон",      Ложь);
		Результат.Вставить("ПроверятьАдресЭП",      Ложь);
		Результат.Вставить("ПроверятьЮрНазвание",   Ложь);
		Константы.НастройкиКонтроляДублейЛиды.Установить(Новый ХранилищеЗначения(Результат, Новый СжатиеДанных(6)));
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьНастройкиКонтроляДублейКонтрагенты() 
	
	НастройкиКонтрагенты = Константы.НастройкиКонтроляДублейКонтрагенты.Получить().Получить();
	
	Если НастройкиКонтрагенты = Неопределено Тогда
		Результат = Новый Соответствие;
		Результат.Вставить("ПроверятьНаименование", Ложь);
		Результат.Вставить("ПроверятьТелефон",      Ложь);
		Результат.Вставить("ПроверятьАдресЭП",      Ложь);
		Результат.Вставить("ПроверятьЮрНазвание",   Ложь);
		
		Константы.НастройкиКонтроляДублейКонтрагенты.Установить(Новый ХранилищеЗначения(Результат, Новый СжатиеДанных(6)));
	КонецЕсли;

КонецПроцедуры

&НаСервере
Процедура ЗаполнитьНастройкиКонтроляДублейКонтакты() 
	
	НастройкиКонтакты = Константы.НастройкиКонтроляДублейКонтакты.Получить().Получить();
	Если НастройкиКонтакты = Неопределено Тогда
		Результат = Новый Соответствие;
		Результат.Вставить("ПроверятьНаименование", Ложь);
		Результат.Вставить("ПроверятьТелефон",      Ложь);
		Результат.Вставить("ПроверятьАдресЭП",      Ложь);
		Результат.Вставить("ПроверятьЮрНазвание",   Ложь);
		
		Константы.НастройкиКонтроляДублейКонтакты.Установить(Новый ХранилищеЗначения(Результат, Новый СжатиеДанных(6)));
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти
