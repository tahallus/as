
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Организация = Справочники.Организации.ОсновнаяОрганизация.ПолноеНаименование();
	
	Если МобильныйКлиентУНФКлиентСервер.ЭтоiOS() Тогда
		Элементы.КакВыУзналиОМК.СписокВыбора[0].Значение = СтрЗаменить(Элементы.КакВыУзналиОМК.СписокВыбора[0].Значение, "%OS%", НСтр("ru='App Store'"));
	Иначе
		Элементы.КакВыУзналиОМК.СписокВыбора[0].Значение = СтрЗаменить(Элементы.КакВыУзналиОМК.СписокВыбора[0].Значение, "%OS%", НСтр("ru='Google Play'"));
	КонецЕсли;
	
	УстановитьВидимостьДоступностьКнопок();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

&НаКлиенте
Процедура МожноЛиСВамиСвязатьсяПриИзменении(Элемент)
	
	УстановитьВидимостьДоступностьКнопок();
	
КонецПроцедуры

&НаКлиенте
Процедура ТелефонПриИзменении(Элемент)
	
	УстановитьВидимостьДоступностьКнопок();
	
КонецПроцедуры

&НаКлиенте
Процедура EmailПриИзменении(Элемент)
	
	УстановитьВидимостьДоступностьКнопок();
	
КонецПроцедуры

&НаКлиенте
Процедура КтоВыВВашейОрганизацииПриИзменении(Элемент)
	
	Если КтоВыВВашейОрганизации = "Другое..." Тогда
		Элементы.КтоВыВВашейОрганизацииДругое.Видимость = Истина;
	Иначе
		Элементы.КтоВыВВашейОрганизацииДругое.Видимость = Ложь;
	КонецЕсли;
	
	ЗаполнитьСписокВопросов();
	УстановитьВидимостьДоступностьКнопок();
	
КонецПроцедуры

&НаКлиенте
Процедура КакВыУзналиОМКПриИзменении(Элемент)
	
	Если КакВыУзналиОМК = "Другое..." Тогда
		Элементы.КакВыУзналиОМКДругое.Видимость = Истина;
	Иначе
		Элементы.КакВыУзналиОМКДругое.Видимость = Ложь;
	КонецЕсли;
	
	УстановитьВидимостьДоступностьКнопок();
	
КонецПроцедуры

&НаКлиенте
Процедура ДляЧегоВыИспользуетеМКПриИзменении(Элемент)
	
	Если ДляЧегоВыИспользуетеМК = "Другое..." Тогда
		Элементы.ДляЧегоВыИспользуетеМКДругое.Видимость = Истина;
	Иначе
		Элементы.ДляЧегоВыИспользуетеМКДругое.Видимость = Ложь;
	КонецЕсли;
	
	УстановитьВидимостьДоступностьКнопок();
	
КонецПроцедуры

&НаКлиенте
Процедура КакЧастоВыИспользуетеМКПриИзменении(Элемент)
	
	Если КакЧастоВыИспользуетеМК = "Другое..." Тогда
		Элементы.КакЧастоВыИспользуетеМКДругое.Видимость = Истина;
	Иначе
		Элементы.КакЧастоВыИспользуетеМКДругое.Видимость = Ложь;
	КонецЕсли;
	
	УстановитьВидимостьДоступностьКнопок();
	
КонецПроцедуры

&НаКлиенте
Процедура ЧтоБыВыХотелиУлучшитьПриИзменении(Элемент)
	
	Если ЧтоБыВыХотелиУлучшить = "Другое..." Тогда
		Элементы.ЧтоБыВыХотелиУлучшитьДругое.Видимость = Истина;
	Иначе
		Элементы.ЧтоБыВыХотелиУлучшитьДругое.Видимость = Ложь;
	КонецЕсли;
	
	УстановитьВидимостьДоступностьКнопок();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура БольшеНеСпрашивать(Команда)
	
	УстановитьЗапретОткрытияФормыОпроса(Истина);
	Закрыть();
	
КонецПроцедуры

&НаКлиенте
Процедура ОтвечуНоПозже(Команда)
	
	Закрыть();
	
КонецПроцедуры

&НаКлиенте
Процедура ХорошоОтвечу(Команда)
	
	Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос1;
	
	УстановитьВидимостьДоступностьКнопок();
	
КонецПроцедуры

&НаКлиенте
Процедура Завершить(Команда)
	
	#Если ВебКлиент Тогда
		Закрыть();
	#Иначе
		ЗначенияСчетчикаЗапусковКлиента = МобильныйКлиентУНФВызовСервера.ЗначенияСчетчикаЗапусковКлиента();
		
		ЗначенияСчетчикаЗапусковКлиента.Вставить("КтоВыВВашейОрганизации", КтоВыВВашейОрганизации);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("КтоВыВВашейОрганизацииДругое", КтоВыВВашейОрганизацииДругое);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("ДляЧегоВыИспользуетеМК", ДляЧегоВыИспользуетеМК);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("ДляЧегоВыИспользуетеМКДругое", ДляЧегоВыИспользуетеМКДругое);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("ДляЧегоВыХотелиБыИспользоватьМКДругое", ДляЧегоВыХотелиБыИспользоватьМКДругое);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("МожноЛиСВамиСвязаться", МожноЛиСВамиСвязаться);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("КакЧастоВыИспользуетеМК", КакЧастоВыИспользуетеМК);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("КакЧастоВыИспользуетеМКДругое", КакЧастоВыИспользуетеМКДругое);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("ЧтоБыВыХотелиУлучшить", ЧтоБыВыХотелиУлучшить);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("ЧтоБыВыХотелиУлучшитьДругое", ЧтоБыВыХотелиУлучшитьДругое);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("ФИО", ФИО);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("Организация", Организация);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("Телефон", Телефон);
		ЗначенияСчетчикаЗапусковКлиента.Вставить("Email", Email);
		
		ЗаписьXML = Новый ЗаписьXML;
		ЗаписьXML.УстановитьСтроку();
		СериализаторXDTO.ЗаписатьXML(ЗаписьXML, ЗначенияСчетчикаЗапусковКлиента);
		ОпросДляОтправки = ЗаписьXML.Закрыть();

		СообщениеОбОшибке = Неопределено;
		СборСтатистикиУНФВызовСервера.ОтправитьСобытиеСДопДанными(НСтр("ru='Опрос по мобильному клиенту'"), ОпросДляОтправки, СообщениеОбОшибке);
		
		Если СообщениеОбОшибке = Неопределено Тогда
			УстановитьЗапретОткрытияФормыОпроса(Истина);
			ПослеПредупреждения = Новый ОписаниеОповещения("ЗакрытьФорму", ЭтотОбъект);
			ПоказатьПредупреждение(ПослеПредупреждения, НСтр("ru='Спасибо, что прошли наш опрос. Мы пришлем книгу сразу, как это будет возможно'"));
		Иначе
			Предупреждение(НСтр("ru='При отправке опроса произошла ошибка интернет соединения. Попробуйте, пожалуйста, еще раз.'"));
		КонецЕсли;
	#КонецЕсли
	
КонецПроцедуры

&НаКлиенте
Процедура Назад(Команда)
	
	Если Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос1 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос0;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос2 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос1;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос3 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос2;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос4 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос3;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос5 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос4;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос6 Тогда
		Если ЗначениеЗаполнено(ДляЧегоВыХотелиБыИспользоватьМКДругое) Тогда
			Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос5;
		Иначе
			Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос4;
		КонецЕсли;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос7 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос6;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос7 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос7;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос8 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос7;
	КонецЕсли;
	
	УстановитьВидимостьДоступностьКнопок();
	
КонецПроцедуры

&НаКлиенте
Процедура Далее(Команда)
	
	Если Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос0 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос1;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос1 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос2;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос2 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос3;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос3 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос4;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос4 Тогда
		Если ЗначениеЗаполнено(ДляЧегоВыХотелиБыИспользоватьМКДругое) Тогда
			Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос5;
		Иначе
			Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос6;
		КонецЕсли;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос5 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос6;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос6 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос7;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос7 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос8;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос8 Тогда
		Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос9;
	КонецЕсли;
	
	УстановитьВидимостьДоступностьКнопок();
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Процедура ЗаполнитьСписокВопросов()
	
	Элементы.ДляЧегоВыИспользуетеМК.СписокВыбора.Очистить();
	
	Если КтоВыВВашейОрганизации = "Директор, руководитель"
		ИЛИ КтоВыВВашейОрганизации = "Бухгалтер" 
		ИЛИ КтоВыВВашейОрганизации = "Другое..." Тогда
		Элементы.ДляЧегоВыИспользуетеМК.СписокВыбора.Добавить(НСтр("ru='Для ведения учета'"));
		Элементы.ДляЧегоВыИспользуетеМК.СписокВыбора.Добавить(НСтр("ru='В качестве рабочего места для мобильных сотрудников'"));
		Элементы.ДляЧегоВыИспользуетеМК.СписокВыбора.Добавить(НСтр("ru='Только для получения отчётов'"));
	КонецЕсли;
	
	Если КтоВыВВашейОрганизации = "Офисный сотрудник"
		ИЛИ КтоВыВВашейОрганизации = "Сотрудник, работающий в полях"
		ИЛИ КтоВыВВашейОрганизации = "Другое..." Тогда
		Элементы.ДляЧегоВыИспользуетеМК.СписокВыбора.Добавить(НСтр("ru='Для работы вне офиса'"));
	КонецЕсли;
	
	Если КтоВыВВашейОрганизации = "Офисный сотрудник"
		ИЛИ КтоВыВВашейОрганизации = "Сотрудник, работающий в полях"
		ИЛИ КтоВыВВашейОрганизации = "Сотрудник производства"
		ИЛИ КтоВыВВашейОрганизации = "Другое..." Тогда
		Элементы.ДляЧегоВыИспользуетеМК.СписокВыбора.Добавить(НСтр("ru='Для работы в офисе, там где нет компьютера'"));
	КонецЕсли;
	
	Элементы.ДляЧегоВыИспользуетеМК.СписокВыбора.Добавить(НСтр("ru='Другое...'"));
	
КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьДоступностьКнопок()
	
	Элементы.ОтвечуНоПозже.Видимость = Ложь;
	Элементы.БольшеНеСпрашивать.Видимость = Ложь;
	Элементы.ХорошоОтвечу.Видимость = Ложь;
	Элементы.Назад.Видимость = Ложь;
	Элементы.Далее.Видимость = Ложь;
	Элементы.Завершить.Видимость = Ложь;
	
	Если Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос0 Тогда
		Элементы.ОтвечуНоПозже.Видимость = Истина;
		Элементы.БольшеНеСпрашивать.Видимость = Истина;
		Элементы.ХорошоОтвечу.Видимость = Истина;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос1 
		ИЛИ Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос2 
		ИЛИ Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос3
		ИЛИ Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос4 
		ИЛИ Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос5
		ИЛИ Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос6
		ИЛИ Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос7 Тогда
		Элементы.Назад.Видимость = Истина;
		Элементы.Далее.Видимость = Истина;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос8 Тогда
		Элементы.Назад.Видимость = Истина;
		Элементы.Завершить.Видимость = Истина;
	КонецЕсли;
	
	Если Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос1 Тогда
		Элементы.Далее.Доступность = ЗначениеЗаполнено(КтоВыВВашейОрганизации);
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос2 Тогда
		Элементы.Далее.Доступность = ЗначениеЗаполнено(КакВыУзналиОМК);
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос3 Тогда
		Элементы.Далее.Доступность = ЗначениеЗаполнено(ДляЧегоВыИспользуетеМК);
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос4 Тогда
		Элементы.Далее.Доступность = Истина;
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос5 Тогда
		Элементы.Далее.Доступность = ЗначениеЗаполнено(МожноЛиСВамиСвязаться);
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос6 Тогда
		Элементы.Далее.Доступность = ЗначениеЗаполнено(КакЧастоВыИспользуетеМК);
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос7 Тогда
		Элементы.Далее.Доступность = ЗначениеЗаполнено(ЧтоБыВыХотелиУлучшить);
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.Вопрос8 Тогда
		Элементы.Завершить.Доступность = ЗначениеЗаполнено(Телефон) ИЛИ ЗначениеЗаполнено(Email);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ЗакрытьФорму(ДопПараметры) Экспорт
	
	Закрыть();
	
КонецПроцедуры

&НаСервере
Процедура УстановитьЗапретОткрытияФормыОпроса(Значение)
	
	РегистрыСведений.СчетчикЗапусковКлиента.УстановитьЗапретОткрытияФормыОпроса(Значение);
	
КонецПроцедуры

#КонецОбласти