
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Объект.Ссылка.Пустая() Тогда
		Объект.ВладелецПодписи = Пользователи.ТекущийПользователь();
		
		ПодписьПоУмолчанию = Символы.ПС + Символы.ПС + "---------------------------------" + Символы.ПС;
		ПодписьHTML = Новый ФорматированнаяСтрока(ПодписьПоУмолчанию);
		ПодписьДляНовыхФорматированныйДокумент.УстановитьФорматированнуюСтроку(ПодписьHTML);
		ПодписьПриОтветеФорматированныйДокумент.УстановитьФорматированнуюСтроку(ПодписьHTML);
		
	Иначе
		ПодписьПриОтветеФорматированныйДокумент = Объект.Ссылка.ПодписьПриОтветеФорматированныйДокумент.Получить();
		ПодписьДляНовыхФорматированныйДокумент = Объект.Ссылка.ПодписьДляНовыхФорматированныйДокумент.Получить();
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	СтрокаСообщения = НСтр("ru = 'Не поддерживается копирование и вставка форматированного текста с картинками.
	|Подпись при ответе.'");
	
	ПодписьHTML = "";
	Картинки = Новый Структура;
	ПодписьПриОтветеФорматированныйДокумент.ПолучитьHTML(ПодписьHTML, Картинки);
	
	Если СтрНайти(НРег(ПодписьHTML), "e1c://") <> 0 Тогда
		ВызватьИсключение СтрокаСообщения;
	КонецЕсли;
	
	ПодписьHTML = "";
	Картинки = Новый Структура;
	ПодписьДляНовыхФорматированныйДокумент.ПолучитьHTML(ПодписьHTML, Картинки);
	
	Если СтрНайти(НРег(ПодписьHTML), "e1c://") <> 0 Тогда
		ВызватьИсключение СтрокаСообщения;
	КонецЕсли;
	
	ТекущийОбъект.ПодписьПриОтветеФорматированныйДокумент = 
	Новый ХранилищеЗначения(ПодписьПриОтветеФорматированныйДокумент);
	
	ТекущийОбъект.ПодписьДляНовыхФорматированныйДокумент = 
	Новый ХранилищеЗначения(ПодписьДляНовыхФорматированныйДокумент);
	
КонецПроцедуры

#КонецОбласти
