
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	УстановитьУсловноеОформлениеФормы();	
	
КонецПроцедуры

#КонецОбласти 

#Область ОбработчикиСобытийЭлементовФормы

&НаКлиенте
Процедура СтруктурныеЕдиницыПриНачалеРедактирования(Элемент, НоваяСтрока, Копирование)
	
	ТекущаяСтрока = Элементы.СтруктурныеЕдиницы.ТекущиеДанные;
	Если НоваяСтрока И Объект.СтруктурныеЕдиницы.Количество()=1 Тогда
		ТекущаяСтрока.ПоУмолчанию = Истина;
	КонецЕсли; 
	
КонецПроцедуры

&НаКлиенте
Процедура СтруктурныеЕдиницыОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	Если ТипЗнч(ВыбранноеЗначение)=Тип("Массив") Тогда
		МассивСтруктурныхЕдиниц = ВыбранноеЗначение;
	Иначе
		МассивСтруктурныхЕдиниц = ОбщегоНазначенияКлиентСервер.ЗначениеВМассиве(ВыбранноеЗначение);
	КонецЕсли; 
	
	Для каждого СтруктурнаяЕдиница Из МассивСтруктурныхЕдиниц Цикл
		
		Если ТипЗнч(СтруктурнаяЕдиница)<>Тип("СправочникСсылка.СтруктурныеЕдиницы") ИЛИ НЕ ЗначениеЗаполнено(СтруктурнаяЕдиница) Тогда
			Возврат;
		КонецЕсли; 
		
		СтруктураОтбора = Новый Структура;
		СтруктураОтбора.Вставить("СтруктурнаяЕдиница", СтруктурнаяЕдиница);
		Если Объект.СтруктурныеЕдиницы.НайтиСтроки(СтруктураОтбора).Количество()=0 Тогда
			НоваяСтрока = Объект.СтруктурныеЕдиницы.Добавить();
			НоваяСтрока.СтруктурнаяЕдиница = СтруктурнаяЕдиница;
			НоваяСтрока.ПоУмолчанию = (Объект.СтруктурныеЕдиницы.Количество()=1);
			Модифицированность = Истина;
		КонецЕсли; 
		
	КонецЦикла; 
	
КонецПроцедуры

#КонецОбласти 

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Подобрать(Команда)
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("РежимВыбора", Истина);
	ПараметрыФормы.Вставить("ЗакрыватьПриВыборе", Ложь);
	ПараметрыФормы.Вставить("Отбор", Новый Структура);
	ПараметрыФормы.Отбор.Вставить("ТипСтруктурнойЕдиницы", ПредопределенноеЗначение("Перечисление.ТипыСтруктурныхЕдиниц.Подразделение"));
	ОткрытьФорму("Справочник.СтруктурныеЕдиницы.ФормаВыбора", ПараметрыФормы, Элементы.СтруктурныеЕдиницы, , , , , РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);	
	
КонецПроцедуры

&НаКлиенте
Процедура ИспользоватьКакОсновное(Команда)
	
	ТекущаяСтрока = Элементы.СтруктурныеЕдиницы.ТекущиеДанные;
	ТекущаяСтрока.ПоУмолчанию = НЕ ТекущаяСтрока.ПоУмолчанию;
	Если ТекущаяСтрока.ПоУмолчанию Тогда
		Для каждого СтрокаТабличнойЧасти Из Объект.СтруктурныеЕдиницы Цикл
			Если ТекущаяСтрока=СтрокаТабличнойЧасти ИЛИ НЕ СтрокаТабличнойЧасти.ПоУмолчанию Тогда
				Продолжить;
			КонецЕсли; 
			СтрокаТабличнойЧасти.ПоУмолчанию = Ложь;
		КонецЦикла; 
	КонецЕсли; 
	
КонецПроцедуры

#КонецОбласти 

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура УстановитьУсловноеОформлениеФормы()
	
	НовоеУсловноеОформление = УсловноеОформление.Элементы.Добавить();
	РаботаСФормой.ДобавитьОформляемыеПоля(НовоеУсловноеОформление, "СтруктурныеЕдиницыСтруктурнаяЕдиница");
	РаботаСФормой.ДобавитьЭлементОтбораКомпоновкиДанных(НовоеУсловноеОформление.Отбор, "Объект.СтруктурныеЕдиницы.ПоУмолчанию", Истина);
	РаботаСФормой.ДобавитьЭлементУсловногоОформления(НовоеУсловноеОформление, "Шрифт", Новый Шрифт(Новый Шрифт, , , Истина));
	
КонецПроцедуры

#КонецОбласти
 
