////////////////////////////////////////////////////////////////////////////////
// Процедуры и функции, предназначенные для группового изменения строк в табличной
//  части и управления оформлением панели редактирования.
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

Функция НастроитьОформлениеПанелиРедактирования(ЭтаФорма, НаборЭлементов, Состояние, Значение, ИзменяетДанные = Неопределено, СвязиПараметровВыбора = Неопределено) Экспорт
	
	Если Состояние = 2 И НаборЭлементов.Действие = ПредопределенноеЗначение("Перечисление.ДействияГрупповогоИзмененияСтрок.УдалитьСтроки") Тогда
		НаборЭлементов.ЗначениеЭлемент.Видимость = Ложь;
		Состояние = 3;
	КонецЕсли;
	
	УстановитьСвязиПараметровВыбора = Неопределено;
	Если Состояние = 0 Тогда
		
		// 0. Панель скрыта
		Если ЗначениеЗаполнено(ИзменяетДанные) И ИзменяетДанные Тогда
			ЭтаФорма.Модифицированность = Истина;
		КонецЕсли;
		
		НаборЭлементов.ПанельРедактирования.Видимость = Ложь;
		НаборЭлементов.КолонкаПометка.Видимость = Ложь;
		НаборЭлементов.КолонкаНомерСтроки.Видимость = Истина;
		
	ИначеЕсли Состояние = 1 Тогда
		
		// 1. Выбор действия
		НаборЭлементов.КолонкаПометка.Видимость = Истина;
		НаборЭлементов.КолонкаНомерСтроки.Видимость = Ложь;
		НаборЭлементов.ПанельРедактирования.Видимость = Истина;
		
		Значение = НаборЭлементов.ЗначениеЭлемент.ОграничениеТипа.ПривестиЗначение("");
		
	ИначеЕсли Состояние = 2 Тогда
		
		// 2. Выбор значения
		Если НаборЭлементов.Действие <> ПредопределенноеЗначение("Перечисление.ДействияГрупповогоИзмененияСтрок.УдалитьСтроки") Тогда
			НаборЭлементов.ЗначениеЭлемент.Видимость = Истина;
		КонецЕсли;
		
		УстановитьСвязиПараметровВыбора = Ложь;
		ГрупповоеИзменениеСтрокКлиентСервер.УстановитьПредставлениеДействия(НаборЭлементов, УстановитьСвязиПараметровВыбора);
		
		Значение = НаборЭлементов.ЗначениеЭлемент.ОграничениеТипа.ПривестиЗначение("");
		
		Если НаборЭлементов.Действие = ПредопределенноеЗначение("Перечисление.ДействияГрупповогоИзмененияСтрок.СоздатьПартииНоменклатуры")
			Тогда
			Значение = НаборЭлементов.Значение
		Иначе
			Значение = НаборЭлементов.ЗначениеЭлемент.ОграничениеТипа.ПривестиЗначение("");
		КонецЕсли;
		
		// Курсор на ввод значения
		ЭтаФорма.ТекущийЭлемент = НаборЭлементов.ЗначениеЭлемент;
		
	ИначеЕсли Состояние = 3 Тогда
		
		// 3. Осталось нажать на кнопку "Выполнить"
		// Курсор на кнопке выполнить
		ЭтаФорма.ТекущийЭлемент = НаборЭлементов.КнопкаВыполнитьДействие;
		
	ИначеЕсли Состояние = 4 Тогда
		
		// 4. Представление изменений
		// Сдвиг табличной части на измененную колонку
		Если ЗначениеЗаполнено(НаборЭлементов.ОбъектИзменений) Тогда
			ЭтаФорма.ТекущийЭлемент = НаборЭлементов.КолонкаОбъектИзменений;
		КонецЕсли;
		
	КонецЕсли;
	
	Результат = Новый Структура;
	Если УстановитьСвязиПараметровВыбора <> Неопределено И УстановитьСвязиПараметровВыбора Тогда
		Результат.Вставить("УстановитьСвязиПараметровВыбора", УстановитьСвязиПараметровВыбора);
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

&НаКлиенте
Процедура СтрокаПометкаПриИзменении(Таблица, ЭлементУстановитьПометки, ЭлементСнятьПометки) Экспорт
	
	Если Таблица.НайтиСтроки(Новый Структура("Пометка", Истина)).Количество() = 0 Тогда
		ЭлементУстановитьПометки.Видимость = Истина;
		ЭлементСнятьПометки.Видимость = Ложь;
	Иначе
		ЭлементУстановитьПометки.Видимость = Ложь;
		ЭлементСнятьПометки.Видимость = Истина;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ОчиститьДействиеЗначение(Действие, Значение) Экспорт
	
	Действие = ПредопределенноеЗначение("Перечисление.ДействияГрупповогоИзмененияСтрок.ПустаяСсылка");
	Значение = "";
	
КонецПроцедуры

// Получает строковое представление действия.
//
// Параметры:
//  ДействиеПеречисление - ПеречислениеСсылка.ДействияГрупповогоИзмененияСтрок - Действие, описание которого необходимо получить.
// Возвращаемое значение:
//  Строка - Представление действия.
Функция ПредставлениеДействия(ДействиеПеречисление) Экспорт
	
	ДействиеПредставление = Строка(ДействиеПеречисление);
	Возврат Лев(ДействиеПредставление, СтрНайти(ДействиеПредставление, "@") - 1);
	
КонецФункции


#КонецОбласти